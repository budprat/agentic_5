/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/supabase/_sync/client.py:303: DeprecationWarning: The 'timeout' parameter is deprecated. Please configure it in the http client instead.
  return SyncPostgrestClient(
/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/supabase/_sync/client.py:303: DeprecationWarning: The 'verify' parameter is deprecated. Please configure it in the http client instead.
  return SyncPostgrestClient(
/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/google/adk/tools/mcp_tool/mcp_tool.py:85: UserWarning: [EXPERIMENTAL] BaseAuthenticatedTool: This feature is experimental and may change or be removed in future versions without notice. It may introduce breaking changes at any time.
  super().__init__(
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
auth_config or auth_config.auth_scheme is missing. Will skip authentication.Using FunctionTool instead if authentication is not required.
Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=RuntimeError('Attempted to exit cancel scope in a different task than it was entered in')>
  + Exception Group Traceback (most recent call last):
  |   File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | BaseExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/mcp/client/sse.py", line 138, in sse_client
    |     yield read_stream, write_stream
    | GeneratorExit
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/mcp/client/sse.py", line 54, in sse_client
    async with anyio.create_task_group() as tg:
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 778, in __aexit__
    if self.cancel_scope.__exit__(type(exc), exc, exc.__traceback__):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 457, in __exit__
    raise RuntimeError(
RuntimeError: Attempted to exit cancel scope in a different task than it was entered in

üîç Checking Dependencies...
‚úÖ All required environment variables are set
‚úÖ Supabase connection available

üöÄ Market Oracle Agent Test Suite
üìÖ 2025-06-28 12:43:53.479097
============================================================

============================================================
üß™ Testing Oracle Prime (Master)
============================================================
‚úÖ Initializing Oracle Prime (Master)...
‚úÖ Oracle Prime (Master) initialized successfully

üì§ Sending request: Analyze AAPL stock
‚úÖ Oracle Prime (Master) responded successfully
üìä Response length: 5955 characters
üìù Response preview: Oracle Prime: Loading portfolio data from Supabase...Oracle Prime: Checking recent signals for AAPL...Oracle Prime: Fetching ML predictions for AAPL...Oracle Prime: Synthesizing investment recommendat...

============================================================
üß™ Testing Fundamental Analyst
============================================================
‚úÖ Initializing Fundamental Analyst...
‚úÖ Fundamental Analyst initialized successfully

üì§ Sending request: Analyze AAPL fundamentals
‚úÖ Fundamental Analyst responded successfully
üìä Response length: 1577 characters
üìù Response preview: Fundamental Analyst: Retrieving SEC filings and financial data...{'symbol': 'AAPL', 'company_name': 'Apple Inc.', 'financial_metrics': {'revenue_ttm': 383.93, 'revenue_growth_yoy': 0.02, 'gross_margin...

============================================================
üß™ Testing Technical Prophet
============================================================
‚úÖ Initializing Technical Prophet...
‚úÖ Technical Prophet initialized successfully

üì§ Sending request: Analyze AAPL technical indicators
‚úÖ Technical Prophet responded successfully
üìä Response length: 8203 characters
üìù Response preview: Technical Prophet: Fetching price data for AAPL...Technical Prophet: Calculating technical indicators...Technical Prophet: Analyzing historical patterns...Technical Prophet: Running ML prediction mode...

============================================================
üß™ Testing Sentiment Seeker
============================================================
‚úÖ Initializing Sentiment Seeker...
‚úÖ Sentiment Seeker initialized successfully

üì§ Sending request: Analyze AAPL sentiment
Traceback (most recent call last):
  File "/home/coder/project/a2a-mcp/src/a2a_mcp/agents/market_oracle/sentiment_seeker_agent_brightdata.py", line 129, in fetch_reddit_data
    async with session.post(url, headers=headers, json=search_data) as response:
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/client.py", line 1482, in __aenter__
    self._resp: _RetType = await self._coro
                           ^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/client.py", line 770, in _request
    resp = await handler(req)
           ^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/client.py", line 725, in _connect_and_send_request
    conn = await self._connector.connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/connector.py", line 622, in connect
    proto = await self._create_connection(req, traces, timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/connector.py", line 1189, in _create_connection
    _, proto = await self._create_direct_connection(req, traces, timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/connector.py", line 1512, in _create_direct_connection
    hosts = await self._resolve_host(host, port, traces=traces)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/connector.py", line 1128, in _resolve_host
    return await asyncio.shield(resolved_host_task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
asyncio.exceptions.CancelledError: Cancelled by cancel scope 7f7b28f33050

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/coder/project/a2a-mcp/test_all_market_oracle_agents.py", line 229, in <module>
    successful, failed = asyncio.run(test_all_agents())
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/asyncio/base_events.py", line 653, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/test_all_market_oracle_agents.py", line 125, in test_all_agents
    success, error = await test_agent(agent_class, agent_name, test_request)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/test_all_market_oracle_agents.py", line 60, in test_agent
    async for chunk in agent.stream(test_request, context_id, task_id):
  File "/home/coder/project/a2a-mcp/src/a2a_mcp/agents/market_oracle/sentiment_seeker_agent_brightdata.py", line 320, in stream
    reddit_data = await self.fetch_reddit_data(symbol)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/coder/project/a2a-mcp/src/a2a_mcp/agents/market_oracle/sentiment_seeker_agent_brightdata.py", line 128, in fetch_reddit_data
    async with aiohttp.ClientSession(timeout=timeout) as session:
  File "/home/coder/project/a2a-mcp/.venv/lib/python3.11/site-packages/aiohttp/connector.py", line 136, in _wait_for_close
    async def _wait_for_close(waiters: List[Awaitable[object]]) -> None:
asyncio.exceptions.CancelledError: Cancelled by cancel scope 7f7b28f33050
